pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--o activates switch, x toots
--by uvehj, based on picozine 1
function _init()
	cls()
	switch_state=0
	train={{32,8,2},{40,8,2},{48,8,2},{56,8,2},{64,8,2},{72,8,2},{80,8,2},{88,8,2},{96,8,2}}
	speed = 0
end
function move_segment(s,dir)
	--spd=dir*2
	--the reasigments are done to avoid overshooting the rail when going too fast
	if s[2] >= 112 then
		s[1]-=speed
		s[2] = 112
		s[3] = 4
	end
	if s[2] <= 8 then
		s[1]+=speed
		s[2] = 8
		s[3] = 2
	end
	if s[1] >= 112 then
		s[2]+=speed
		s[1] = 112
		s[3] = 3
	end
	if s[1] <= 8 then
		s[2]-=speed
		s[1] = 8
		s[3] = 1
	end
end
function update_speed()
	if speed <= 0 and switch_state != 0 then
		speed = 0.1
	end
	if switch_state == 0 then
		speed = speed * 0.98
	elseif switch_state == 1 then
		speed = speed * 1.05
	else
		speed = speed * 1.5
	end

	if speed < 0.1 then
		speed = 0
	end

	if speed > 1.5 and switch_state == 1 then
		speed = 1.5
	elseif speed > 2 and switch_state == 2 then
		speed = 2
	end
end
function adv_switch()
	if(switch_state<2) then
		switch_state+=1
	else
		switch_state=0 
	end
end
function move_train()
	for t in all(train) do
		move_segment(t,switch_state)
	end
end
function _update()
	if (btnp(4)) then
		adv_switch()
	end
	if (btnp(5)) then
		sfx(0)
	end
	update_speed()
	move_train()
end
function draw_train()
	local len=count(train)
	for t=1,len do
		if(t==1) then
			if train[t][3] == 1 then
				sprite = 26
			elseif train[t][3] == 2 then
				sprite = 8
			elseif train[t][3] == 3 then
				sprite = 24
			else
				sprite = 10
			end
		else
			if(t==len) then
				if train[t][3] == 1 then
					sprite = 24
				elseif train[t][3] == 2 then
					sprite = 10
				elseif train[t][3] == 3 then
					sprite = 26
				else
					sprite = 8
				end
			else 
				if train[t][3] == 1 or  train[t][3] == 3 then
					sprite = 25
				else
					sprite = 9
				end
			end
		end
		spr(sprite,train[t][1],train[t][2])
	end
end
function draw_switch()
	if (switch_state==1) then
		sspr(0,16,16,16,56,56,16,16)
	elseif (switch_state==2) then
		sspr(16,16,16,16,56,56,16,16)
	else 
		sspr(64,16,16,16,56,56,16,16)
	end
end
function _draw()
	map(0,0,0,0,16,16)
	draw_switch()
	draw_train()
end
__gfx__
00000000000000004444444444454444444444444444444444444444666666660000111111111111111100001111111111111111111111110000000000000000
000000000000000055444444444554444666666666666666666666646666666600111cc1111111111cc1110018888881122222211aaaaaa10000000000000000
0000000000000000454444444444554446555555555555555555556466666666111cccc11cccccc11cccc11118111181122222211a9999a10000000000000000
00000000000000004544444444444544465666466466646666466564666666661cccaac11caaaac11caaccc118111181122222211a9889a10000000000000000
00000000000000004444445444444454465466466466646666464564666666661cccaac11caaaac11caaccc118111181122222211a9889a10000000000000000
0000000000000000444444544444445546564555555555555554656466666666111cccc11cccccc11cccc11118111181122222211a9999a10000000000000000
000000000000000044444454444444444656656666666666665665646666666600111cc1111111111cc1110018888881122222211aaaaaa10000000000000000
00000000000000004444445444444444465445644444444446544564666666660000111111111111111100001111111111111111111111110000000000000000
00000000000000004444445444444444465665644888844446566564000000000011110011111111111111110000000000000000000000000000000000000000
0000000000000000444455544444444446566564448668444656656400000000001cc10011cccc111cccccc10000000000000000000000000000000000000000
0000000000000000444554444444444446544564444866844654456400000000011cc11011caac111ccaacc10000000000000000000000000000000000000000
000000000000000044544444444445444656656444448668465665640000000001cccc1011caac1111caac110000000000000000000000000000000000000000
000000000000000044544444444555444656656444448668465665640000000011caac1111caac1101cccc100000000000000000000000000000000000000000
00000000000000004454444444454444465445644448668446544564000000001ccaacc111caac11011cc1100000000000000000000000000000000000000000
00000000000000004554444444544444465665644486684446566564000000001cccccc111cccc11001cc1000000000000000000000000000000000000000000
00000000000000004544444445444444465665644888844446566564000000001111111111111111001111000000000000000000000000000000000000000000
0005555555555000000555555555500046544564444444444656656400000000000555dddd555000000000000000000000000000000000000000000000000000
005555555555dd00005555555555550046566566666666666654456400000000005555d77d555500000000000000000000000000000000000000000000000000
05555555555777d00555555555555550465645555555555555566564000000000555557777555550000000000000000000000000000000000000000000000000
5555555555dd77d5555555555555555546546646646664664646656400000000555555dddd555555000000000000000000000000000000000000000000000000
555555555dddd755555555555555555546566646646664664664656400000000555555dddd555555000000000000000000000000000000000000000000000000
55555555ddddd555555555555555555546555555555555555555556400000000555555dddd555555000000000000000000000000000000000000000000000000
5555555ddddd5555ddddddddddddd7dd46666666666666666666666400000000555555dddd555555000000000000000000000000000000000000000000000000
555555ddddd55555ddddddddddddd77d44444444444444444444444400000000555555dddd555555000000000000000000000000000000000000000000000000
55555ddddd555555ddddddddddddd77d66666666666666666666666600000000555555dddd555555000000000000000000000000000000000000000000000000
5555ddddd5555555ddddddddddddd7dd66688666666666666666666600000000555555dddd555555000000000000000000000000000000000000000000000000
555ddddd55555555555555555555555566888866699999966999999600000000555555dddd555555000000000000000000000000000000000000000000000000
55ddddd555555555555555555555555568877886697999966979979600000000555555dddd555555000000000000000000000000000000000000000000000000
5ddddd5555555555555555555555555568888886699799966997997600000000555555dddd555555000000000000000000000000000000000000000000000000
0dddd55555555550055555555555555066888866697999966979979600000000055555dddd555550000000000000000000000000000000000000000000000000
00dd555555555500005555555555550066688666699999966999999600000000005555dddd555500000000000000000000000000000000000000000000000000
0005555555555000000555555555500066666666666666666666666600000000000555dddd555000000000000000000000000000000000000000000000000000
__label__
44444444444444544444444444444444444444444444444444444444444544444445444444454444444544444444444444444444444444444444444444444444
55444444444455545544444455444444554444445544444455444444444554444445544444455444444554444444444444444444444444444444444444444444
45444444444554444544444445444444454444444544444445444444444455444444554444445544444455444444444444444444444444444444444444444444
45444444445444444544444445444444454444444544444445444444444445444444454444444544444445444444454444444544444445444444454444444544
44444454445444444444445444444454444444544444445444444454444444544444445444444454444444544445554444455544444555444445554444455544
44444454445444444444445444444454444444544444445444444454444444554444445544444455444444554445444444454444444544444445444444454444
44444454455444444444445444444454444444544444445444444454444444444444444444444444444444444454444444544444445444444454444444544444
44444454454444444444445444444454444444544444445444444454444444444444444444444444444444444544444445444444454444444544444445444444
44444454444411111111111111114111111111114444444444444444444444444444444444444444444444444444444444444444444444444444444444444454
4444555446661111111111111111611111111cc11166666666666666666666666666666666666666666666666666666666666666666666666666666444445554
4445544411111cccccc11cccccc151cccccc1cccc111555555555555555555555555555555555555555555555555555555555555555555555555556444455444
4454444411cc1caaaac11caaaac161caaaac1caaccc1646664666466646664666466646664666466646664666466646664666466646664666646656444544444
4454444411ca1caaaac11caaaac161caaaac1caaccc1646664666466646664666466646664666466646664666466646664666466646664666646456444544444
4454444411ca1cccccc11cccccc151cccccc1cccc111555555555555555555555555555555555555555555555555555555555555555555555554656444544444
4554444411ca1111111111111111611111111cc11166666666666666666666666666666666666666666666666666666666666666666666666656656445544444
4544444411ca11111111111111114111111111114444444444444444444444444444444444444444444444444444444444444444444444444654456445444444
4444445411cccc114444445444454444444544444445444444454444444444444445444444454444444544444444444444444444444544444656656444444454
44445554111111114444555444455444444554444445544444455444444444444445544444455444444554444444444444444444444554444656656444445554
44455444465445644445544444445544444455444444554444445544444444444444554444445544444455444444444444444444444455444654456444455444
44544444111111114454444444444544444445444444454444444544444445444444454444444544444445444444454444444544444445444656656444544444
4454444411cccc114454444444444454444444544444445444444454444555444444445444444454444444544445554444455544444444544656656444544444
4454444411caac114454444444444455444444554444445544444455444544444444445544444455444444554445444444454444444444554654456444544444
4554444411caac114554444444444444444444444444444444444444445444444444444444444444444444444454444444544444444444444656656445544444
4544444411caac114544444444444444444444444444444444444444454444444444444444444444444444444544444445444444444444444656656445444444
4444445411caac114444445444444454444444444445444444454444444544444445444444444444444544444444444444444454444444544656656444444454
4444555411cccc114444555444445554444444444445544444455444444554444445544444444444444554444444444444445554444455544656656444445554
44455444111111114445544444455444444444444444554444445544444455444444554444444444444455444444444444455444444554444654456444455444
4454444411cccc114454444444544444444445444444454444444544444445444444454444444544444445444444454444544444445444444656656444544444
4454444411caac114454444444544444444555444444445444444454444444544444445444455544444444544445554444544444445444444656656444544444
4454444411caac114454444444544444444544444444445544444455444444554444445544454444444444554445444444544444445444444654456444544444
4554444411caac114554444445544444445444444444444444444444444444444444444444544444444444444454444445544444455444444656656445544444
4544444411caac114544444445444444454444444444444444444444444444444444444445444444444444444544444445444444454444444656656445444444
4444445411cccc114444444444444444444444444444444444444454444544444445444444454444444544444444445444454444444444544656656444444454
44445554111111114444444444444444444444444444444444445554444554444445544444455444444554444444555444455444444455544656656444445554
44455444111111114444444444444444444444444444444444455444444455444444554444445544444455444445544444445544444554444654456444455444
4454444411cccc114444454444444544444445444444454444544444444445444444454444444544444445444454444444444544445444444656656444544444
4454444411caac114445554444455544444555444445554444544444444444544444445444444454444444544454444444444454445444444656656444544444
4454444411caac114445444444454444444544444445444444544444444444554444445544444455444444554454444444444455445444444654456444544444
4554444411caac114454444444544444445444444454444445544444444444444444444444444444444444444554444444444444455444444656656445544444
4544444411caac114544444445444444454444444544444445444444444444444444444444444444444444444544444444444444454444444656656445444444
4444444411cccc114444445444444454444544444444444444454444444544444445444444444444444544444444444444444444444444544656656444444454
44444444111111114444555444445554444554444444444444455444444554444445544444444444444554444444444444444444444455544656656444445554
44444444465445644445544444455444444455444444444444445544444455444444554444444444444455444444444444444444444554444654456444455444
44444544111111114454444444544444444445444444454444444544444445444444454444444544444445444444454444444544445444444656656444544444
444555441cccccc14454444444544444444444544445554444444454444444544444445444455544444444544445554444455544445444444656656444544444
444544441ccaacc14454444444544444444444554445444444444455444444554444445544454444444444554445444444454444445444444654456444544444
4454444411caac114554444445544444444444444454444444444444444444444444444444544444444444444454444444544444455444444656656445544444
4544444441cccc144544444445444444444444444544444444444444444444444444444445444444444444444544444445444444454444444656656445444444
44444454411cc1144444445444454444444544444444444466666666666666666666666666666666444544444444444444444444444444444656656444454444
44445554461cc1644444555444455444444554444444444466666666666666666668866666666666444554444444444444444444444444444656656444455444
44455444461111644445544444445544444455444444444466666666666666666688886669999996444455444444444444444444444444444654456444445544
44544444465665644454444444444544444445444444454466666666666666666887788669799996444445444444454444444544444445444656656444444544
44544444465665644454444444444454444444544445554466666666666666666888888669979996444444544445554444455544444555444656656444444454
44544444465445644454444444444455444444554445444466666666666666666688886669799996444444554445444444454444444544444654456444444455
45544444465665644554444444444444444444444454444466666666666666666668866669999996444444444454444444544444445444444656656444444444
45444444465665644544444444444444444444444544444466666666666666666666666666666666444444444544444445444444454444444656656444444444
44444454465665644444445444454444444444444444444466666666666555555555566666666666444444444444444444444454444444444656656444444454
44445554465665644444555444455444444444444444444466666666665555555555dd6666666666444444444444444444445554444444444656656444445554
4445544446544564444554444444554444444444444444446666666665555555555777d669999996444444444444444444455444444444444654456444455444
445444444656656444544444444445444444454444444544666666665555555555dd77d569799796444445444444454444544444444445444656656444544444
44544444465665644454444444444454444555444445554466666666555555555dddd75569979976444555444445554444544444444555444656656444544444
4454444446544564445444444444445544454444444544446666666655555555ddddd55569799796444544444445444444544444444544444654456444544444
455444444656656445544444444444444454444444544444666666665555555ddddd555569999996445444444454444445544444445444444656656445544444
45444444465665644544444444444444454444444544444466666666555555ddddd5555566666666454444444544444445444444454444444656656445444444
4444444446566564444444444445444444444454444444446666666655555ddddd55555566666666444444444445444444444454444444444656656444444454
444444444656656444444444444554444444555444444444666666665555ddddd555555566666666444444444445544444445554444444444656656444445554
44444444465445644444444444445544444554444444444466666666555ddddd5555555566666666444444444444554444455444444444444654456444455444
4444454446566564444445444444454444544444444445446666666655ddddd55555555566666666444445444444454444544444444445444656656444544444
444555444656656444455544444444544454444444455544666666665ddddd555555555566666666444555444444445444544444444555444656656444544444
444544444654456444454444444444554454444444454444666666666dddd5555555555666666666444544444444445544544444444544444654456444544444
4454444446566564445444444444444445544444445444446666666666dd55555555556666666666445444444444444445544444445444444656656445544444
45444444465665644544444444444444454444444544444466666666666555555555566666666666454444444444444445444444454444444656656445444444
44444444465665644445444444454444444444544445444466666666666666666666666666666666444544444445444444454444444544444656656444444454
44444444465665644445544444455444444455544445544466666666666666666666666666666666444554444445544444455444444554444656656444445554
44444444465445644444554444445544444554444444554466666666666666666666666666666666444455444444554444445544444455444654456444455444
44444544465665644444454444444544445444444444454466666666666666666666666666666666444445444444454444444544444445444656656444544444
44455544465665644444445444444454445444444444445466666666666666666666666666666666444444544444445444444454444444544656656444544444
44454444465445644444445544444455445444444444445566666666666666666666666666666666444444554444445544444455444444554654456444544444
44544444465665644444444444444444455444444444444466666666666666666666666666666666444444444444444444444444444444444656656445544444
45444444465665644444444444444444454444444444444466666666666666666666666666666666444444444444444444444444444444444656656445444444
44444444465665644445444444454444444544444445444444454444444544444445444444454444444544444444445444454444444544444656656444454444
44444444465665644445544444455444444554444445544444455444444554444445544444455444444554444444555444455444444554444656656444455444
44444444465445644444554444445544444455444444554444445544444455444444554444445544444455444445544444445544444455444654456444445544
44444544465665644444454444444544444445444444454444444544444445444444454444444544444445444454444444444544444445444656656444444544
44455544465665644444445444444454444444544444445444444454444444544444445444444454444444544454444444444454444444544656656444444454
44454444465445644444445544444455444444554444445544444455444444554444445544444455444444554454444444444455444444554654456444444455
44544444465665644444444444444444444444444444444444444444444444444444444444444444444444444554444444444444444444444656656444444444
45444444465665644444444444444444444444444444444444444444444444444444444444444444444444444544444444444444444444444656656444444444
44444444465665644445444444454444444444544444445444444454444444544444445444454444444444544445444444454444444444544656656444454444
44444444465665644445544444455444444455544444555444445554444455544444555444455444444455544445544444455444444455544656656444455444
44444444465445644444554444445544444554444445544444455444444554444445544444445544444554444444554444445544444554444654456444445544
44444544465665644444454444444544445444444454444444544444445444444454444444444544445444444444454444444544445444444656656444444544
44455544465665644444445444444454445444444454444444544444445444444454444444444454445444444444445444444454445444444656656444444454
44454444465445644444445544444455445444444454444444544444445444444454444444444455445444444444445544444455445444444654456444444455
44544444465665644444444444444444455444444554444445544444455444444554444444444444455444444444444444444444455444444656656444444444
45444444465665644444444444444444454444444544444445444444454444444544444444444444454444444444444444444444454444444656656444444444
44444444465665644444445444444454444444544445444444444454444444544445444444444444444444544444444444444444444444544656656444454444
44444444465665644444555444445554444455544445544444445554444455544445544444444444444455544444444444444444444455544656656444455444
44444444465445644445544444455444444554444444554444455444444554444444554444444444444554444444444444444444444554444654456444445544
44444544465665644454444444544444445444444444454444544444445444444444454444444544445444444444454444444544445444444656656444444544
44455544465665644454444444544444445444444444445444544444445444444444445444455544445444444445554444455544445444444656656444444454
44454444465445644454444444544444445444444444445544544444445444444444445544454444445444444445444444454444445444444654456444444455
44544444465665644554444445544444455444444444444445544444455444444444444444544444455444444454444444544444455444444656656444444444
45444444465665644544444445444444454444444444444445444444454444444444444445444444454444444544444445444444454444444656656444444444
44444444465665644445444444444454444544444444445444454444444444544445444444454444444544444445444444454444444544444656656444444444
44444444465665644445544444445554444554444444555444455444444455544445544444455444444554444445544444455444444554444656656455444444
44444444465445644444554444455444444455444445544444445544444554444444554444445544444455444444554444445544444455444654456445444444
44444544465665644444454444544444444445444454444444444544445444444444454444444544444445444444454444444544444445444656656445444444
44455544465665644444445444544444444444544454444444444454445444444444445444444454444444544444445444444454444444544656656444444454
44454444465445644444445544544444444444554454444444444455445444444444445544444455444444554444445544444455444444554654456444444454
44544444465665644444444445544444444444444554444444444444455444444444444444444444444444444444444444444444444444444656656444444454
45444444465665644444444445444444444444444544444444444444454444444444444444444444444444444444444444444444444444444656656444444454
44444444465445644444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444656656444444444
44444444465665666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666654456455444444
44444444465645555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555556656445444444
44444544465466466466646664666466646664666466646664666466646664666466646664666466646664666466646664666466646664664646656445444444
44455544465666466466646664666466646664666466646664666466646664666466646664666466646664666466646664666466646664664664656444444454
44454444465555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555556444444454
44544444466666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666444444454
45444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444454
44444454444444444444444444444444444444444445444444454444444444544445444444444454444544444444445444444444444444444444444444454444
44445554444444444444444444444444444444444445544444455444444455544445544444445554444554444444555455444444554444445544444444455444
44455444444444444444444444444444444444444444554444445544444554444444554444455444444455444445544445444444454444444544444444445544
44544444444445444444454444444544444445444444454444444544445444444444454444544444444445444454444445444444454444444544444444444544
44544444444555444445554444455544444555444444445444444454445444444444445444544444444444544454444444444454444444544444445444444454
44544444444544444445444444454444444544444444445544444455445444444444445544544444444444554454444444444454444444544444445444444455
45544444445444444454444444544444445444444444444444444444455444444444444445544444444444444554444444444454444444544444445444444444
45444444454444444544444445444444454444444444444444444444454444444444444445444444444444444544444444444454444444544444445444444444

__map__
0212020202020203030303131313131300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1204050505050505050505050505061200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214120303030313030303131303161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121213030303031303131212161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214131313131203030303120312161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314121203130303031303131312161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214120303130707343503131313160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214120313130707073613131213161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314130312130707070713031213161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314030312030707070703030303161200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314030303030303030303120303160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314030312121212120312030312160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314121212031212031312131312160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1314031203120312030303030303160200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1324252525252525252525252525260200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213131313030312031203120202020300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000400002825028250282502825028250331000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
